<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Retorno Real</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Calculadora de Retorno Real üìà</h1>
            <p class="subtitle">Descubra se seu investimento realmente venceu a infla√ß√£o (IPCA) usando dados oficiais do Banco Central.</p>
        </header>

        <form method="post" class="search-box">
            <div class="input-group">
                <label>Ativo (Ticker)</label>
                <input type="text" name="ticker" placeholder="Ex: PETR4, VALE3" required value="{{ request.form.get('ticker', '') }}">
            </div>
            
            <div class="input-group">
                <label>Data Inicial</label>
                <input type="date" name="start_date" required value="{{ request.form.get('start_date', '2023-01-01') }}">
            </div>
            
            <div class="input-group">
                <label>Valor Investido (R$)</label>
                <input type="number" name="amount" step="0.01" placeholder="1000.00" required value="{{ request.form.get('amount', '1000') }}">
            </div>

            <button type="submit" id="analyze-btn">Calcular Ganho Real</button>
        </form>

        {% if error %}
            <div class="error-message">‚ö†Ô∏è {{ error }}</div>
        {% endif %}

        {% if results %}
        <div class="results-section">
            <div class="kpi-grid">
                <div class="kpi-card">
                    <h3>Retorno Nominal</h3>
                    <p class="{{ 'positive' if results.nominal_return > 0 else 'negative' }}">
                        {{ "%.2f"|format(results.nominal_return) }}%
                    </p>
                    <span class="kpi-detail">Saldo: R$ {{ "%.2f"|format(results.final_amount) }}</span>
                </div>

                <div class="kpi-card">
                    <h3>Infla√ß√£o (IPCA)</h3>
                    <p class="negative">-{{ "%.2f"|format(results.inflation_total) }}%</p>
                    <span class="kpi-detail">Corros√£o do poder de compra</span>
                </div>

                <div class="kpi-card highlight">
                    <h3>Ganho Real</h3>
                    <p class="{{ 'positive' if results.is_profit else 'negative' }}">
                        {{ "%.2f"|format(results.real_return) }}%
                    </p>
                    <span class="kpi-detail">Acima da infla√ß√£o</span>
                </div>
            </div>

            <div class="verdict">
                {% if results.is_profit %}
                    <p>‚úÖ <strong>Excelente!</strong> O ativo <strong>{{ results.ticker }}</strong> protegeu seu capital e gerou riqueza real.</p>
                {% else %}
                    <p>‚ùå <strong>Aten√ß√£o!</strong> Apesar do retorno nominal, o ativo <strong>{{ results.ticker }}</strong> perdeu para a infla√ß√£o neste per√≠odo.</p>
                {% endif %}
            </div>

            <div class="chart-container">
                <img src="{{ url_for('static', filename=results.chart) }}" alt="Gr√°fico de Retorno Real">
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        //seleciona os elementos HTML para manipula√ß√£o de estado
        const btn = document.getElementById('analyze-btn');
        const form = document.querySelector('form');
        // --- Feedback de Carregamento ---
        //intercepta o envio do formul√°rio para dar feedback imediato ao usu√°rio,
        //pois consultas ao BC e Yahoo Finance podem ter lat√™ncia
        form.addEventListener('submit', () => {
            btn.innerText = 'Processando dados do BC e Bolsa...';
            btn.style.opacity = '0.7'; //indica visualmente que o bot√£o est√° desabilitado/ocupado
        });
    </script>
</body>
</html>